<div class="sidebar-content">
  <!-- Header -->
  <div class="sidebar-header">
    <h2>Account</h2>
  </div>

  <ion-content>
    <!-- Utente Corrente -->
    @if (currentAppUser(); as AppUser) {
      <div class="current-AppUser-section">
        <h3>Utente Corrente</h3>
        <ion-item class="current-AppUser-item">
          <ion-avatar slot="start">
            @if (AppUser.avatar) {
              <img [src]="AppUser.avatar" [alt]="AppUser.name">
            } @else {
              <div class="avatar-placeholder" 
                   [class.parent]="AppUser.role === 'parent'"
                   [class.child-male]="AppUser.role === 'child' && AppUser.sex === 'male'"
                   [class.child-female]="AppUser.role === 'child' && AppUser.sex === 'female'">
                <ion-icon [name]="AppUser.role === 'parent' ? 'person-outline' : 'happy-outline'"></ion-icon>
              </div>
            }
          </ion-avatar>
          <ion-label>
            <h2>{{ AppUser.name }}</h2>
            <p>{{ AppUser.email }}</p>
            <p class="role-badge" 
               [class.parent]="AppUser.role === 'parent'"
               [class.child-male]="AppUser.role === 'child' && AppUser.sex === 'male'"
               [class.child-female]="AppUser.role === 'child' && AppUser.sex === 'female'">
              {{ AppUser.role === 'parent' ? 'Genitore' : (AppUser.sex === 'male' ? 'Bambino' : 'Bambina') }}
            </p>
          </ion-label>
        </ion-item>
      </div>
    }

    <!-- Profili Famiglia -->
    <div class="family-section">
      <div class="section-header">
        <h3>Famiglia</h3>
        <ion-button 
          fill="clear" 
          size="small"
          (click)="addProfile()">
          <ion-icon name="add-outline"></ion-icon>
        </ion-button>
      </div>

      <ion-list>
        @for (profile of familyProfiles(); track profile.id) {
          <ion-item 
            button
            [class.selected]="selectedProfile()?.id === profile.id"
            (click)="selectProfile(profile)">
            
            <ion-avatar slot="start">
              @if (profile.avatar) {
                <img [src]="profile.avatar" [alt]="profile.name">
              } @else {
                <div class="avatar-placeholder" 
                     [class.parent]="profile.role === 'parent'"
                     [class.child-male]="profile.role === 'child' && profile.sex === 'male'"
                     [class.child-female]="profile.role === 'child' && profile.sex === 'female'">
                  <ion-icon [name]="profile.role === 'parent' ? 'person-outline' : 'happy-outline'"></ion-icon>
                </div>
              }
            </ion-avatar>

            <ion-label>
              <h2>{{ profile.name }}</h2>
              @if (profile.email) {
                <p>{{ profile.email }}</p>
              }
              <p class="role-badge" 
                 [class.parent]="profile.role === 'parent'"
                 [class.child-male]="profile.role === 'child' && profile.sex === 'male'"
                 [class.child-female]="profile.role === 'child' && profile.sex === 'female'">
                {{ profile.role === 'parent' ? 'Genitore' : (profile.sex === 'male' ? 'Bambino' : 'Bambina') }}
              </p>
            </ion-label>

            @if (selectedProfile()?.id === profile.id) {
              <ion-icon name="checkmark-circle" slot="end" color="success"></ion-icon>
            }
          </ion-item>
        }
      </ion-list>
    </div>

    <!-- Azioni -->
    <div class="actions-section">
      <ion-button 
        expand="block" 
        fill="outline"
        (click)="goToSettings()">
        <ion-icon name="settings-outline" slot="start"></ion-icon>
        Impostazioni
      </ion-button>

      <ion-button 
        expand="block" 
        color="danger" 
        fill="outline"
        (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Logout
      </ion-button>
    </div>
  </ion-content>
</div>